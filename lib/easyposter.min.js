/**
 * @license
 * EasyPoster v1.0.0
 * Copyright (c) 2019 Kevin.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("visual-yoga-layout-prebuilt")):"function"==typeof define&&define.amd?define(["exports","visual-yoga-layout-prebuilt"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).easyposter={},t.yoga)}(this,(function(t,e){"use strict";function n(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,o.get?o:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var o=n(e),i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},i(t,e)};function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+e+" is not a constructor or null");function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{l(o.next(t))}catch(t){r(t)}}function a(t){try{l(o.throw(t))}catch(t){r(t)}}function l(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}l((o=o.apply(t,e||[])).next())}))}function a(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(s=0)),s;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,o=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&i[3]>a[1])){s.label=a[1];break}if(6===a[0]&&i[1]>s.label){s.label=i[1],i=a;break}if(i&&i[2]>s.label){s.label=i[2],s.ops.push(a);break}i[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}var u=function(){function t(t){this.type="node",this._layout=o.Node.create(),this._style=t}return Object.defineProperty(t.prototype,"style",{get:function(){return this._style},set:function(t){this._style=t,this._setStyle(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bound",{get:function(){var t=this._layout.getComputedLayout();return{left:t.left,top:t.top,width:t.width,height:t.height}},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"layout",{get:function(){return this._layout},enumerable:!1,configurable:!0}),t.prototype.render=function(){throw Error("the render() has not been implemented.")},t.prototype._setStyle=function(t){var e=this;Object.keys(t).map((function(t){return e._setStyleItem(t)}))},t.prototype._setStyleItem=function(t){var e=this._style[t];if(void 0!==e)switch(t){case"width":this._layout.setWidth(e);break;case"height":this._layout.setHeight(e);break;case"maxWidth":this._layout.setMaxWidth(e);break;case"maxHeight":this._layout.setMaxHeight(e);break;case"minWidth":this._layout.setMinWidth(e);break;case"minHeight":this._layout.setMinHeight(e);break;case"margin":this._setMargin(e);break;case"padding":this._setPadding(e);break;case"position":this._setPosition(e);break;case"flex":this._layout.setFlex(e);break;case"flexDirection":this._setFlexDirection(e);break;case"flexBasis":this._layout.setFlexBasis(e);break;case"flexGrow":this._layout.setFlexGrow(e);break;case"flexWrap":this._setFlexWrap(e);break;case"flexShrink":this._layout.setFlexShrink(e);break;case"justifyContent":this._setJustifyContent(e);break;case"alignItems":this._setAlignItems(e);break;case"alignContent":this._setAlignContent(e);break;case"alignSelf":this._setAlignSelf(e)}},t.prototype._setMargin=function(t){void 0===t&&(t="0 0 0 0");var e=l(t.split(" "),4),n=e[1],i=e[2],r=e[3];this._layout.setMargin(o.EDGE_TOP,parseFloat(e[0])),this._layout.setMargin(o.EDGE_RIGHT,parseFloat(n)),this._layout.setMargin(o.EDGE_BOTTOM,parseFloat(i)),this._layout.setMargin(o.EDGE_LEFT,parseFloat(r))},t.prototype._setPadding=function(t){void 0===t&&(t="0 0 0 0");var e=l(t.split(" "),4),n=e[1],i=e[2],r=e[3];this._layout.setPadding(o.EDGE_TOP,parseFloat(e[0])),this._layout.setPadding(o.EDGE_RIGHT,parseFloat(n)),this._layout.setPadding(o.EDGE_BOTTOM,parseFloat(i)),this._layout.setPadding(o.EDGE_LEFT,parseFloat(r))},t.prototype._setPosition=function(t){void 0===t&&(t="relative"),this._layout.setPositionType("absolute"===t?o.POSITION_TYPE_ABSOLUTE:o.POSITION_TYPE_RELATIVE);var e=this._style,n=e.top,i=e.right,r=e.bottom,s=e.left;void 0!==n&&this._layout.setPosition(o.EDGE_TOP,n),void 0!==i&&this._layout.setPosition(o.EDGE_RIGHT,i),void 0!==r&&this._layout.setPosition(o.EDGE_BOTTOM,r),void 0!==s&&this._layout.setPosition(o.EDGE_LEFT,s)},t.prototype._setFlexDirection=function(t){"column"===t&&this._layout.setFlexDirection(o.FLEX_DIRECTION_COLUMN),"column-reverse"===t&&this._layout.setFlexDirection(o.FLEX_DIRECTION_COLUMN_REVERSE),"row"===t&&this._layout.setFlexDirection(o.FLEX_DIRECTION_ROW),"row-reverse"===t&&this._layout.setFlexDirection(o.FLEX_DIRECTION_ROW_REVERSE)},t.prototype._setFlexWrap=function(t){"nowrap"===t&&this._layout.setFlexWrap(o.WRAP_NO_WRAP),"wrap"===t&&this._layout.setFlexWrap(o.WRAP_WRAP),"wrap-reverse"===t&&this._layout.setFlexWrap(o.WRAP_WRAP_REVERSE)},t.prototype._setJustifyContent=function(t){"flex-start"===t&&this._layout.setJustifyContent(o.JUSTIFY_FLEX_START),"flex-end"===t&&this._layout.setJustifyContent(o.JUSTIFY_FLEX_END),"center"===t&&this._layout.setJustifyContent(o.JUSTIFY_CENTER),"space-around"===t&&this._layout.setJustifyContent(o.JUSTIFY_SPACE_AROUND),"space-between"===t&&this._layout.setJustifyContent(o.JUSTIFY_SPACE_BETWEEN)},t.prototype._setAlignItems=function(t){"baseline"===t&&this._layout.setAlignItems(o.ALIGN_BASELINE),"center"===t&&this._layout.setAlignItems(o.ALIGN_CENTER),"flex-end"===t&&this._layout.setAlignItems(o.ALIGN_FLEX_END),"flex-start"===t&&this._layout.setAlignItems(o.ALIGN_FLEX_START),"stretch"===t&&this._layout.setAlignItems(o.ALIGN_STRETCH)},t.prototype._setAlignContent=function(t){"baseline"===t&&this._layout.setAlignContent(o.ALIGN_BASELINE),"center"===t&&this._layout.setAlignContent(o.ALIGN_CENTER),"flex-end"===t&&this._layout.setAlignContent(o.ALIGN_FLEX_END),"flex-start"===t&&this._layout.setAlignContent(o.ALIGN_FLEX_START),"stretch"===t&&this._layout.setAlignContent(o.ALIGN_STRETCH),"space-around"===t&&this._layout.setAlignContent(o.ALIGN_SPACE_AROUND),"space-between"===t&&this._layout.setAlignContent(o.ALIGN_SPACE_BETWEEN)},t.prototype._setAlignSelf=function(t){"baseline"===t&&this._layout.setAlignSelf(o.ALIGN_BASELINE),"center"===t&&this._layout.setAlignSelf(o.ALIGN_CENTER),"flex-end"===t&&this._layout.setAlignSelf(o.ALIGN_FLEX_END),"flex-start"===t&&this._layout.setAlignSelf(o.ALIGN_FLEX_START),"stretch"===t&&this._layout.setAlignSelf(o.ALIGN_STRETCH)},t}(),c=function(t){function e(e,n){void 0===n&&(n=[]);var o=t.call(this,e)||this;return o.children=[],o.type="group",o._availableNodeType=["image","text","group"],o.addChildren(n),o}return r(e,t),e.prototype.addChildren=function(t){void 0===t&&(t=[]);for(var e=0;t.length>e;e++)this.addChild(t[e])},e.prototype.render=function(){return!0},e.prototype.addChild=function(t){if(!t.type)throw console.error(t),Error("The node does not have a 'type' property.");if(!this._availableNodeType.includes(t.type))return console.error("The 'type' property of the child node is incorrect. It must be one of 'image', 'group', or 'text'."),void console.error(t);this.children.push(t),this._layout.insertChild(t.layout,this.children.length-1)},e}(u),h={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpeg"},y=function(t){function e(){var e=t.call(this)||this,n=e._canvas=document.createElement("canvas");return e._context=n.getContext("2d"),n.style.display="none",document.body.appendChild(n),e}return r(e,t),e.prototype.drawImage=function(t){var e,n=t.bound;null===(e=this._context)||void 0===e||e.drawImage(t.image,n.left,n.top,n.width,n.height)},e.prototype.exportPoster=function(t,e){return this._canvas.toDataURL(h[t],e)},e.prototype.drawText=function(t){var e,n=this;if(this._context){var o=t.style,i=o.maxWidth,r=o.width,s=o.lineHeight,a=o.left,u=o.top,c=o.fontFamily,h=o.color;if(c){var y=o.fontWeight||500,f=Number(o.fontSize)||"16px";this._context.font="".concat(y," ").concat(f,"px ").concat(c)}else this._context.font="";this._context.fillStyle=h||"#000000";for(var p=Number(a)||0,_=Number(u)||0,d=Number(r)||Number(i)||this.width,g=Number(s)||parseInt(window.getComputedStyle(this._canvas).lineHeight)||parseInt(window.getComputedStyle(document.body).lineHeight),E=function(t,e,n){if(n||2===arguments.length)for(var o,i=0,r=e.length;r>i;i++)!o&&i in e||(o||(o=Array.prototype.slice.call(e,0,i)),o[i]=e[i]);return t.concat(o||Array.prototype.slice.call(e))}([],l(t.text),!1),b=function(e,o,i){var r,s,a,l=o,u=(null===(s=null===(r=n._context)||void 0===r?void 0:r.measureText(e))||void 0===s?void 0:s.width)||0;"center"===t.style.textAlign&&(l=o+.5*(d-u)),"right"===t.style.textAlign&&(l=o+(d-u)),null===(a=n._context)||void 0===a||a.fillText(e,l,i)},v="",m=0;E.length>m;m++){var x=v+E[m],A=null===(e=this._context)||void 0===e?void 0:e.measureText(x);((null==A?void 0:A.width)||0)>d&&m>0?(b(v,p,_),v=E[m],_+=g):v=x}b(v,p,_)}},e.prototype.toString=function(){return"WebRenderer with Canvas2D"},e}((function(){})),f=new y,p=function(t){function e(e,n){var o=t.call(this,e)||this;if(o.type="image",!n)throw Error("image node not source");return o._image=n,o}return r(e,t),Object.defineProperty(e.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),e.prototype.render=function(){try{return f.drawImage(this),!0}catch(t){return console.error(t),!1}},e}(u),_=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.type="stage",o.width=e.width||0,o.height=e.height||0,o._setRenderWH(),o._setStageStyle(),o}return r(e,t),e.prototype.calculateLayout=function(){this._layout.calculateLayout(Number(this.width),Number(this.height),o.DIRECTION_LTR)},e.prototype.exportImageSrc=function(t,e){return void 0===t&&(t="png"),void 0===e&&(e=.6),f.exportPoster(t,e)},e.prototype._setRenderWH=function(){f.width=Number(this.width),f.height=Number(this.height)},e.prototype._setStageStyle=function(){this._layout.setWidth(this.width),this._layout.setHeight(this.height)},e}(c),d=function(t){function e(e,n){var o=t.call(this,e)||this;return o.type="text",o._text="",o._text=n,o}return r(e,t),Object.defineProperty(e.prototype,"text",{get:function(){return this._text},enumerable:!1,configurable:!0}),e.prototype.render=function(){try{return f.drawText(this),!0}catch(t){return console.error(t),!1}},e}(u);t.createPoster=function(t,e,n){!function(t,e,n){var o=this,i=[];!function t(e){if("image"!==e.type)return"stage"===e.type||"group"===e.type?e.children.forEach((function(e){return t(e)})):void 0;i.push(e.src)}(t),console.log("图片列表",i);var r=i.length,l=[];function u(t){return new Promise((function(e){var n=new Image;n.crossOrigin="anonymous",n.src=t,n.onload=function(){e(n)},n.onerror=function(){e(n)}}))}i.forEach((function(t,i){return s(o,void 0,void 0,(function(){var o;return a(this,(function(s){switch(s.label){case 0:return[4,u(t)];case 1:return o=s.sent(),l.push(o),null==e||e((i+1)/r),i===r-1&&(null==n||n(l)),[2]}}))}))}))}(t,e,(function(e){var o=function(t,e){void 0===e&&(e={type:"stage",style:{},children:[]});var n=function e(n){if("image"===n.type)return new p(n.style,t.shift());if("text"===n.type)return new d(n.style,n.text);var o=n.children.map((function(t){return e(t)}));return"stage"===n.type?new _(n.style,o):new c(n.style,o)}(e);return n}(e,t);o.calculateLayout(),o.render(),null==n||n()}))},Object.defineProperty(t,"__esModule",{value:!0})}));
